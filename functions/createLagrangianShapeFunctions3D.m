close all; clear; clc;

syms x y z

% Xe=sym([0 1 0; 0 0 1; 0 0 0; 1 0 0])
% Xe=sym([0 1 0; 0 0 1; 0 0 0; 1 0 0; 0 1/2 1/2; 0 0 1/2; 0 1/2 0; 1/2 1/2 0; 1/2 0 1/2; 1/2 0 0])
% Xe=sym([0 1 0; 0 0 1; 0 0 0; 1 0 0; 0 2/3 1/3; 0 1/3 2/3; 0 0 2/3; 0 0 1/3; 0 2/3 0; 0 1/3 0; 1/3 2/3 0; 2/3 1/3 0; 1/3 0 2/3; 2/3 0 1/3; 1/3 0 0; 2/3 0 0; 0 1/3 1/3; 1/3 0 1/3; 1/3 1/3 1/3; 1/3 1/3 0]);
% Xe=sym([0 1 0; 0 0 1; 0 0 0; 1 0 0; 0 3/4 1/4; 0 2/4 2/4; 0 1/4 3/4; 0 0 3/4; 0 0 2/4; 0 0 1/4; 0 3/4 0; 0 2/4 0; 0 1/4 0; 1/4 3/4 0; 2/4 2/4 0; 3/4 1/4 0; 1/4 0 3/4; 2/4 0 2/4; 3/4 0 1/4; 1/4 0 0; 2/4 0 0; 3/4 0 0; 0 1/4 1/4; 0 1/4 2/4; 0 2/4 1/4; 2/4 0 1/4; 1/4 0 2/4; 1/4 0 1/4; 1/4 2/4 1/4; 1/4 1/4 2/4; 2/4 1/4 1/4; 1/4 2/4 0; 2/4 1/4 0; 1/4 1/4 0; 1/4 1/4 1/4])
% Xe=sym([0 1 0; 0 0 1; 0 0 0; 1 0 0; 0 4/5 1/5; 0 3/5 2/5; 0 2/5 3/5; 0 1/5 4/5; 0 0 4/5; 0 0 3/5; 0 0 2/5; 0 0 1/5; 0 4/5 0; 0 3/5 0; 0 2/5 0; 0 1/5 0; 1/5 4/5 0; 2/5 3/5 0; 3/5 2/5 0; 4/5 1/5 0; 1/5 0 4/5; 2/5 0 3/5; 3/5 0 2/5; 4/5 0 1/5; 1/5 0 0; 2/5 0 0; 3/5 0 0; 4/5 0 0; 0 1/5 1/5; 0 1/5 2/5; 0 1/5 3/5; 0 2/5 2/5; 0 3/5 1/5; 0 2/5 1/5; 3/5 0 1/5; 2/5 0 2/5; 1/5 0 3/5; 1/5 0 2/5; 1/5 0 1/5; 2/5 0 1/5; 1/5 3/5 1/5; 1/5 2/5 2/5; 1/5 1/5 3/5; 2/5 1/5 2/5; 3/5 1/5 1/5; 2/5 2/5 1/5; 1/5 3/5 0; 2/5 2/5 0; 3/5 1/5 0; 2/5 1/5 0; 1/5 1/5 0; 1/5 2/5 0; 1/5 2/5 1/5; 1/5 1/5 2/5; 1/5 1/5 1/5; 2/5 1/5 1/5])
% Xe=sym([0 1 0; 0 0 1; 0 0 0; 1 0 0; 0 5/6 1/6; 0 4/6 2/6; 0 3/6 3/6; 0 2/6 4/6; 0 1/6 5/6; 0 0 5/6; 0 0 4/6; 0 0 3/6; 0 0 2/6; 0 0 1/6; 0 5/6 0; 0 4/6 0; 0 3/6 0; 0 2/6 0; 0 1/6 0; 1/6 5/6 0; 2/6 4/6 0; 3/6 3/6 0; 4/6 2/6 0; 5/6 1/6 0; 1/6 0 5/6; 2/6 0 4/6; 3/6 0 3/6; 4/6 0 2/6; 5/6 0 1/6; 1/6 0 0; 2/6 0 0; 3/6 0 0; 4/6 0 0; 5/6 0 0; 0 1/6 1/6; 0 1/6 2/6; 0 1/6 3/6; 0 1/6 4/6; 0 2/6 3/6; 0 3/6 2/6; 0 4/6 1/6; 0 3/6 1/6; 0 2/6 1/6; 0 2/6 2/6; 4/6 0 1/6; 3/6 0 2/6; 2/6 0 3/6; 1/6 0 4/6; 1/6 0 3/6; 1/6 0 2/6; 1/6 0 1/6; 2/6 0 1/6; 3/6 0 1/6; 2/6 0 2/6; 1/6 4/6 1/6; 1/6 3/6 2/6; 1/6 2/6 3/6; 1/6 1/6 4/6; 2/6 1/6 3/6; 3/6 1/6 2/6; 4/6 1/6 1/6; 3/6 2/6 1/6; 2/6 3/6 1/6; 2/6 2/6 2/6; 1/6 4/6 0; 2/6 3/6 0; 3/6 2/6 0; 4/6 1/6 0; 3/6 1/6 0; 2/6 1/6 0; 1/6 1/6 0; 1/6 2/6 0; 1/6 3/6 0; 2/6 2/6 0; 1/6 3/6 1/6; 1/6 1/6 3/6; 1/6 1/6 1/6; 3/6 1/6 1/6; 1/6 2/6 2/6; 1/6 1/6 2/6; 1/6 2/6 1/6; 2/6 2/6 1/6; 2/6 1/6 2/6; 2/6 1/6 1/6])
% Xe=sym([0 1 0; 0 0 1; 0 0 0; 1 0 0; 0 6/7 1/7; 0 5/7 2/7; 0 4/7 3/7; 0 3/7 4/7; 0 2/7 5/7; 0 1/7 6/7; 0 0 6/7; 0 0 5/7; 0 0 4/7; 0 0 3/7; 0 0 2/7; 0 0 1/7; 0 6/7 0; 0 5/7 0; 0 4/7 0; 0 3/7 0; 0 2/7 0; 0 1/7 0; 1/7 6/7 0; 2/7 5/7 0; 3/7 4/7 0; 4/7 3/7 0; 5/7 2/7 0; 6/7 1/7 0; 1/7 0 6/7; 2/7 0 5/7; 3/7 0 4/7; 4/7 0 3/7; 5/7 0 2/7; 6/7 0 1/7; 1/7 0 0; 2/7 0 0; 3/7 0 0; 4/7 0 0; 5/7 0 0; 6/7 0 0; 0 1/7 1/7; 0 1/7 2/7; 0 1/7 3/7; 0 1/7 4/7; 0 1/7 5/7; 0 2/7 4/7; 0 3/7 3/7; 0 4/7 2/7; 0 5/7 1/7; 0 4/7 1/7; 0 3/7 1/7; 0 2/7 1/7; 0 2/7 2/7; 0 2/7 3/7; 0 3/7 2/7; 5/7 0 1/7; 4/7 0 2/7; 3/7 0 3/7; 2/7 0 4/7; 1/7 0 5/7; 1/7 0 4/7; 1/7 0 3/7; 1/7 0 2/7; 1/7 0 1/7; 2/7 0 1/7; 3/7 0 1/7; 4/7 0 1/7; 3/7 0 2/7; 2/7 0 3/7; 2/7 0 2/7; 1/7 5/7 1/7; 1/7 4/7 2/7; 1/7 3/7 3/7; 1/7 2/7 4/7; 1/7 1/7 5/7; 2/7 1/7 4/7; 3/7 1/7 3/7; 4/7 1/7 2/7; 5/7 1/7 1/7; 4/7 2/7 1/7; 3/7 3/7 1/7; 2/7 4/7 1/7; 2/7 3/7 2/7; 2/7 2/7 3/7; 3/7 2/7 2/7; 1/7 5/7 0; 2/7 4/7 0; 3/7 3/7 0; 4/7 2/7 0; 5/7 1/7 0; 4/7 1/7 0; 3/7 1/7 0; 2/7 1/7 0; 1/7 1/7 0; 1/7 2/7 0; 1/7 3/7 0; 1/7 4/7 0; 2/7 3/7 0; 3/7 2/7 0; 2/7 2/7 0; 1/7 4/7 1/7; 1/7 1/7 4/7; 1/7 1/7 1/7; 4/7 1/7 1/7; 1/7 3/7 2/7; 1/7 2/7 3/7; 1/7 1/7 3/7; 1/7 1/7 2/7; 1/7 3/7 1/7; 1/7 2/7 1/7; 2/7 3/7 1/7; 3/7 2/7 1/7; 2/7 1/7 3/7; 3/7 1/7 2/7; 2/7 1/7 1/7; 3/7 1/7 1/7; 1/7 2/7 2/7; 2/7 1/7 2/7; 2/7 2/7 2/7; 2/7 2/7 1/7])
% Xe=sym([0 1 0; 0 0 1; 0 0 0; 1 0 0; 0 7/8 1/8; 0 6/8 2/8; 0 5/8 3/8; 0 4/8 4/8; 0 3/8 5/8; 0 2/8 6/8; 0 1/8 7/8; 0 0 7/8; 0 0 6/8; 0 0 5/8; 0 0 4/8; 0 0 3/8; 0 0 2/8; 0 0 1/8; 0 7/8 0; 0 6/8 0; 0 5/8 0; 0 4/8 0; 0 3/8 0; 0 2/8 0; 0 1/8 0; 1/8 7/8 0; 2/8 6/8 0; 3/8 5/8 0; 4/8 4/8 0; 5/8 3/8 0; 6/8 2/8 0; 7/8 1/8 0; 1/8 0 7/8; 2/8 0 6/8; 3/8 0 5/8; 4/8 0 4/8; 5/8 0 3/8; 6/8 0 2/8; 7/8 0 1/8; 1/8 0 0; 2/8 0 0; 3/8 0 0; 4/8 0 0; 5/8 0 0; 6/8 0 0; 7/8 0 0; 0 1/8 1/8; 0 1/8 2/8; 0 1/8 3/8; 0 1/8 4/8; 0 1/8 5/8; 0 1/8 6/8; 0 2/8 5/8; 0 3/8 4/8; 0 4/8 3/8; 0 5/8 2/8; 0 6/8 1/8; 0 5/8 1/8; 0 4/8 1/8; 0 3/8 1/8; 0 2/8 1/8; 0 2/8 2/8; 0 2/8 3/8; 0 2/8 4/8; 0 3/8 3/8; 0 4/8 2/8; 0 3/8 2/8; 6/8 0 1/8; 5/8 0 2/8; 4/8 0 3/8; 3/8 0 4/8; 2/8 0 5/8; 1/8 0 6/8; 1/8 0 5/8; 1/8 0 4/8; 1/8 0 3/8; 1/8 0 2/8; 1/8 0 1/8; 2/8 0 1/8; 3/8 0 1/8; 4/8 0 1/8; 5/8 0 1/8; 4/8 0 2/8; 3/8 0 3/8; 2/8 0 4/8; 2/8 0 3/8; 2/8 0 2/8; 3/8 0 2/8; 1/8 6/8 1/8; 1/8 5/8 2/8; 1/8 4/8 3/8; 1/8 3/8 4/8; 1/8 2/8 5/8; 1/8 1/8 6/8; 2/8 1/8 5/8; 3/8 1/8 4/8; 4/8 1/8 3/8; 5/8 1/8 2/8; 6/8 1/8 1/8; 5/8 2/8 1/8; 4/8 3/8 1/8; 3/8 4/8 1/8; 2/8 5/8 1/8; 2/8 4/8 2/8; 2/8 3/8 3/8; 2/8 2/8 4/8; 3/8 2/8 3/8; 4/8 2/8 2/8; 3/8 3/8 2/8; 1/8 6/8 0; 2/8 5/8 0; 3/8 4/8 0; 4/8 3/8 0; 5/8 2/8 0; 6/8 1/8 0; 5/8 1/8 0; 4/8 1/8 0; 3/8 1/8 0; 2/8 1/8 0; 1/8 1/8 0; 1/8 2/8 0; 1/8 3/8 0; 1/8 4/8 0; 1/8 5/8 0; 2/8 4/8 0; 3/8 3/8 0; 4/8 2/8 0; 3/8 2/8 0; 2/8 2/8 0; 2/8 3/8 0; 1/8 5/8 1/8; 1/8 1/8 5/8; 1/8 1/8 1/8; 5/8 1/8 1/8; 1/8 4/8 2/8; 1/8 3/8 3/8; 1/8 2/8 4/8; 1/8 1/8 4/8; 1/8 1/8 3/8; 1/8 1/8 2/8; 1/8 4/8 1/8; 1/8 3/8 1/8; 1/8 2/8 1/8; 2/8 4/8 1/8; 3/8 3/8 1/8; 4/8 2/8 1/8; 2/8 1/8 4/8; 3/8 1/8 3/8; 4/8 1/8 2/8; 2/8 1/8 1/8; 3/8 1/8 1/8; 4/8 1/8 1/8; 1/8 2/8 2/8; 1/8 2/8 3/8; 1/8 3/8 2/8; 3/8 1/8 2/8; 2/8 1/8 3/8; 2/8 1/8 2/8; 2/8 3/8 2/8; 2/8 2/8 3/8; 3/8 2/8 2/8; 2/8 3/8 1/8; 3/8 2/8 1/8; 2/8 2/8 1/8; 2/8 2/8 2/8])

Pascal=[1,...
        x,y,z,...
        x^2,y^2,z^2,x*y,y*z,x*z,...
        x^3,y^3,z^3,x^2*y,x*y^2,y^2*z,y*z^2,x^2*z,x*z^2,x*y*z,...
        x^4,y^4,z^4,x^3*y,x^2*y^2,x*y^3,y^3*z,y^2*z^2,y*z^3,x^3*z,x^2*z^2,x*z^3,x^2*y*z,x*y^2*z,x*y*z^2,...
        x^5,y^5,z^5,x^4*y,x^3*y^2,x^2*y^3,x*y^4,y^4*z,y^3*z^2,y^2*z^3,y*z^4,x^4*z,x^3*z^2,x^2*z^3,x*z^4,x^3*y*z,x^2*y^2*z,x*y^3*z,x*y^2*z^2,x*y*z^3,x^2*y*z^2,...
        x^6,y^6,z^6,x^5*y^1,x^4*y^2,x^3*y^3,x^2*y^4,x*y^5,y^5*z,y^4*z^2,y^3*z^3,y^2*z^4,y*z^5,x^5*z,x^4*z^2,x^3*z^3,x^2*z^4,x*z^5,x^4*y*z,x^3*y^2*z,x^2*y^3*z,x*y^4*z,x*y^3*z^2,x*y^2*z^3,x*y*z^4,x^2*y*z^3,x^3*y*z^2,x^2*y^2*z^2,...
        x^7,y^7,z^7,x^6*y,x^5*y^2,x^4*y^3,x^3*y^4,x^2*y^5,x*y^6,y^6*z,y^5*z^2,y^4*z^3,y^3*z^4,y^2*z^5,y*z^6,x^6*z,x^5*z^2,x^4*z^3,x^3*z^4,x^2*z^5,x*z^6,x^5*y*z,x^4*y^2*z,x^3*y^3*z,x^2*y^4*z,x*y^5*z,x*y^4*z^2,x*y^3*z^3,x*y^2*z^4,x*y*z^5,x^2*y*z^4,x^3*y*z^3,x^4*y*z^2,x^3*y^2*z^2,x^2*y^3*z^2,x^2*y^2*z^3,...
        x^8,y^8,z^8,x^7*y,x^6*y^2,x^5*y^3,x^4*y^4,x^3*y^5,x^2*y^6,x*y^7,y^7*z,y^6*z^2,y^5*z^3,y^4*z^4,y^3*z^5,y^2*z^6,y*z^7,x^7*z,x^6*z^2,x^5*z^3,x^4*z^4,x^3*z^5,x^2*z^6,x*z^7,x^6*y*z,x^5*y^2*z,x^4*y^3*z,x^3*y^4*z,x^2*y^5*z,x*y^6*z,x*y^5*z^2,x*y^4*z^3,x*y^3*z^4,x*y^2*z^5,x*y*z^6,x^2*y*z^5,x^3*y*z^4,x^4*y*z^3,x^5*y*z^2,x^4*y^2*z^2,x^3*y^3*z^2,x^2*y^4*z^2,x^2*y^3*z^3,x^2*y^2*z^4,x^3*y^2*z^3];

imax=size(Xe,1);

PascalSym=Pascal(1:imax);
x=Xe(:,1); y=Xe(:,2); z=Xe(:,3);
PascalNum=[ones(imax,1),eval(PascalSym(2:end))];

N=sym(zeros(1,imax));

A=PascalNum;
for i=1:imax
  b=sym(zeros(imax,1));
  b(i)=1;
  C=A\b;
  N(i)=C'*transpose(PascalSym);
end

N=simplify(N)

eval(N)

syms x y z

% Derivatives of the shape functions
NXi=diff(N,x);
NEta=diff(N,y);
NZeta=diff(N,z);

% Vectors of ones and zeros
syms I O real

% Create strings
N(abs(N)==1)=I*sign(N(abs(N)==1)); N(N==0)=O;
N=['[',strjoin(arrayfun(@char,N,'uniform',0),', '),']'];
N=strrep(strrep(strrep(strrep(strrep(N,' ',''),'*','.*'),'/','./'),'^','.^'),',',', ')

NXi(abs(NXi)==1)=I*sign(NXi(abs(NXi)==1)); NXi(NXi==0)=O;
NXi=['[',strjoin(arrayfun(@char,NXi,'uniform',0),', '),']'];
NXi=strrep(strrep(strrep(strrep(strrep(NXi,' ',''),'*','.*'),'/','./'),'^','.^'),',',', ')

NEta(abs(NEta)==1)=I*sign(NEta(abs(NEta)==1)); NEta(NEta==0)=O;
NEta=['[',strjoin(arrayfun(@char,NEta,'uniform',0),', '),']'];
NEta=strrep(strrep(strrep(strrep(strrep(NEta,' ',''),'*','.*'),'/','./'),'^','.^'),',',', ')

NZeta(abs(NZeta)==1)=I*sign(NZeta(abs(NZeta)==1)); NZeta(NZeta==0)=O;
NZeta=['[',strjoin(arrayfun(@char,NZeta,'uniform',0),', '),']'];
NZeta=strrep(strrep(strrep(strrep(strrep(NZeta,' ',''),'*','.*'),'/','./'),'^','.^'),',',', ')

% Plot element
figure;
pdeplot3D(eval(Xe(1:4,:)'),(1:4)','FaceColor','w','EdgeColor','k','FaceAlpha',0.5)
for i=1:imax
  text(eval(Xe(i,1)),eval(Xe(i,2)),eval(Xe(i,3)),sprintf('%d',i),...
       'HorizontalAlignment','Center','VerticalAlignment','Middle')
end